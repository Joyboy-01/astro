---
import { Footer, Header, ThemeProvider } from 'astro-pure/components/basic'
import type { SiteMeta } from 'astro-pure/types'
import BaseHead from '@/components/BaseHead.astro'
import config from '@/site-config'

// Import the global.css file here so that it is included on
// all pages through the use of the <BaseLayout /> component.
import '@/assets/styles/app.css'

interface Props {
  meta: SiteMeta
  highlightColor?: string
}

const {
  meta: { articleDate, description = config.description, ogImage, title },
  highlightColor,
  ...props
} = Astro.props
---

<html lang={config.locale.lang}>
  <head>
    <BaseHead {articleDate} {description} {ogImage} {title} />
    <ThemeProvider />
  </head>

  <body class='flex justify-center bg-background text-foreground' {...props}>
    {
      highlightColor && (
        <div
          id='highlight-gradient'
          class='pointer-events-none absolute start-0 top-0 z-0 h-screen w-full opacity-25'
          style={`background-image:linear-gradient(${highlightColor},transparent)`}
        />
      )
    }
    <div class='w-full max-w-[70rem] px-4 sm:px-7 lg:px-10'>
      <Header />
      <slot />
      <Footer />
    </div>

    {/* Set highlight color */}
    <style define:vars={{ highlightColor }}>
      :global(.highlight) {
        color: var(--highlightColor, hsl(var(--primary) / var(--un-text-opacity))) !important;
      }
      :global(.highlight-bg) {
        background-color: var(
          --highlightColor,
          hsl(var(--primary) / var(--un-text-opacity))
        ) !important;
      }
    </style>
    <!-- 在 </body> 之前添加这个超级强制的修复 -->
    <script is:inline>
    (function() {
      function ultimateQRCodeFix() {
        const button = document.getElementById('get-qrcode')
        const container = document.getElementById('qrcode-container')
        
        if (button && container) {
          // 完全替换按钮的点击处理
          button.removeAttribute('onclick')
          const events = ['click', 'mousedown', 'mouseup']
          events.forEach(event => {
            button.removeEventListener(event, arguments.callee)
          })
          
          button.style.cursor = 'pointer'
          button.onclick = function(e) {
            e.preventDefault()
            e.stopImmediatePropagation()
            
            const isVisible = container.style.opacity === '1'
            
            if (isVisible) {
              container.style.maxHeight = '0'
              container.style.opacity = '0'
              container.style.transform = 'translateY(0)'
              container.setAttribute('aria-expanded', 'false')
            } else {
              container.style.maxHeight = '200px'
              container.style.opacity = '1'
              container.style.transform = 'translateY(16px)'
              container.setAttribute('aria-expanded', 'true')
            }
            
            console.log('QRCode toggled:', !isVisible ? 'shown' : 'hidden')
            return false
          }
          
          console.log('Ultimate QRCode fix applied!')
          return true
        }
        return false
      }
      
      // 多次尝试修复
      const attempts = [100, 500, 1000, 2000]
      attempts.forEach(delay => {
        setTimeout(ultimateQRCodeFix, delay)
      })
      
      window.addEventListener('load', () => {
        setTimeout(ultimateQRCodeFix, 100)
      })
    })()
    </script>
  </body>
</html>
